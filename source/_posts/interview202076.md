---
title: 面试整理以及反思
date: 2020-07-06 20:08:02
tags:
- 面筋
- PHP
---

> 今天的面试自己总体来说感觉不太理想，总体来说还是自己技术不太到位，这边整理下今天面试的题目以及会问到的问题。多给自己涨涨知识吧。

### 第一家公司：包图网

> 这家公司给我的整体印象还是不错的，毕竟我意向中的包图网是我挺感兴趣的公司。这家公司面试下来整体结果不太理想。

> 以下是我印象比较深刻的几个问题。而且是我觉得自己也没有怎么接触的地方

1. 用户输入网址后，都进行了什么操作？
    
    > 问题难度： 简单，但是我就是没回答上来，因为我这边没看这块的东西，只知道有tcp的三次握手和四次挥手。。。
    
    > 解答：
   
    * 用户输入网址，浏览器进行地址解析
    * 应用层将解析出的域名进行域名解析
    * 传输层进行tcp三次握手，建立tcp连接。
    * 应用层客户端向web服务器发送http请求
    * 网络层IP协议查询Mac地址
    * 服务器收到处理请求
    * 服务器发送http响应报文，浏览器收到服务器响应，得到html代码
    * 页面渲染
        * 解析html
        * 构建dom树
        * dom树与css样式进行附着构造呈现树
        * 布局
        * 绘制
    
    > 有些详细的解答这边请到网上查看下，这边只是对题目进行解析

2. 主键索引和普通索引查询时的区别
    
    > 问题难度： 简单， 我这边其实有了解过，但是当时没想到会问这个问题，所以emmm，我竟然忘记了。。
    
    > 解答：

    ```sql
        select * from table where id = 1
        select * from table where name = 'tb'
    ```
   > 上面两个语句都返回了一条数据，这边就查询的时候会有区别，如果查询为主键，mysql 只需要搜索id这颗B+树，而查询普通索引时，mysql会先搜索name索引树，得到id为1，再到ID树搜索一次。这个过程称为回表。
   
   > 因此我们查询时，尽量使用主键查询。
 
3. 数据库分表                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
    
> 问题难度： 对于三年的PHP程序员应该是算是中等的把。。 

> 这块我查了一点资料，引用别人的文章吧，我这边写出来应该和他也差不多。
> 我特么也不知道原创是谁，网上都特么抄的。
[数据库分库分表](https://www.cnblogs.com/butterfly100/p/9034281.html)

> 以上是我第一家公司的面试经历。以及遇到的几个问题，这边会接着反思。不过回来的时候淋成了落汤鸡。。。

### 第二家公司： 捞月狗

> 这家公司我能说是我最感兴趣的一家吗，不止是工作环境，我也有时候会用他们的APP。。。 以及整体方向，都跟我是最符合的。由于自己使用laravel都是自学吧。。 感觉入坑时间太短，还是要深入研究下。

>  这家公司基本上问的都是简历上的内容，比如一些经常用的数据库的应用之类的，数据库的读写分离，以及对你PHP基础的考察。

> 主要问我的还是我架构的一些东西，比如我现公司做的一些项目之类的，以及对我了解的技术进行考察。这边还是要抓紧学习下laravel，出去面试了才知道laravel的东西不仅仅是这些。。

1. 数据库的读写分离有时候会有主从延迟问题问题，你知道怎么解决吗？
> 这个我确实是不了解，但是我瞎吹比了，emmm，也是头疼，这个就应该说不会啊。。。
> 解决方法：
* 分库，将一个主库拆分为多个主库，每个主库的写并发就减少了几倍，此时主从延迟忽略不计。
* 打开mysql的并行复制，多个库进行复制。如果说某个库的写入时间并发特别高，单库写入并发达到了200/s，并行复制还是没意义。
* 重写代码，插入数据不是立马就能查得到。
* 如果必须存在插入时就查出这条数据，对这个查询直接连接主库，这样读写分离就无意义了。

2. laravel的核心：
* 门面
* 契约
* 服务容器
> 这个我确实不了解。。。emmm，需要更多的学习进行补足这块的知识吧。

3. 还有一个就是问我用到哪个中间件
> 我特么就是瞎吹比啊。。我真是服了我自己了。。。。

> 总体来说这次出去面试对我来说，我的信心增大了，
>学习目标更明确了。也是对自己的锻炼吧，白白浪费两次机会。瞎搞。而且是俩小大厂啊。emmmm，加油，继续干。
> 对于这次面试来说，我需要学习的内容后面的安排是：

* 深入PHP，HTTP，TCP协议
* 研究laravel的框架核心。

> 完成这两项之后噻，就继续去面试。希望能给自己更大的帮助。
>

### 更新： 20200806

> 今天受打击了。问的都是一些深入性问题，了解不透彻

> 一个面试官拿着redis问这问那，我。。。

> 这个是我没注意看的东西： 
#### laravel的生命周期：

> laravel的所有请求都是 public/index.php文件，所有请求都会被web服务器导入到此文件
>接下来，请求发送到HTTP内核或者console内核（分别用于处理web请求和artisan命令）
>内核启动过程中最重要的内容之一就是为应用载入服务提供者。应用所有的服务提供者都被配置在 config/app 配置文件的providers 数组中
>，首先，所有提供者的register方法被调用，然后，所有提供者注册之后，boot方法被调用。
>接下来就是分发请求，一旦应用被启动并且所有的服务提供者被注册，request 将会被交给路由器分发
>，路由器将会分发请求到路由或者控制器，同事运行所有路由指定的中间件。

> 上面这个问题说简单也简单，但是不注意看的话有时候被问到也会很尴尬。

> 然后就是一系列深入的问题，比如下面这个：
### 用redis存储10w用户一年365天的登陆状态，你会怎么存储。
> 方法有很多种。下面这种是:

> 使用redis的bitmap数据结构，setbit getbit两条命令是对字符串的位操作，每个位只能是0/1
>然后用bitcount命令计算这个key有多少个1

> 比如今天是第30天，用户a进入了网站，那么执行setbit a 30 1 如果明天a用户也浏览了网站
>那么执行setbit a 31 1 ，以此类推

> 然后使用bitcount命令，执行 bitcount a， 得出结果就是a上线的总天数

> 使用bittops命令来对多天的key做一个或运算，就知道某个时间段内的活跃人数
> bittops key bit [start][end] 返回为图中第一个值为bit的二进制位的位置

> 比如 bittops a 1 10 100

> 上面就是一种处理方式。其它的方法可以自己多看看

> 然后就进入了虐人的环节，我对redis本来就不是很熟，结果一通redis过来，我整个人都不太好。

#### redis如何做持久化的？
> 这个我当时说了不了解，这边还是整理下吧。后面面试还是能用到。

> bgsave做镜像全量持久化，aof做增量持久化，因为bgsave会耗费较长时间，不够实时，在停机的时候会导致大量丢失数据，
>所以需要aof来配合使用。在redis实力重启时，有限使用aof来恢复内存的状态，如果没有aof日志，就会使用rdb文件来恢复。

> 顺便整理下有可能会问的问题：
>aof文件过大恢复时间过长怎么办： 

> redis会定期做aof重写，压缩aof文件的日志大小。Redis4.0之后有了混合持久化的功能，将bgsave的全量和aof的增量做了融合处理，这样既保证了恢复的效率
>又兼顾了数据的安全性。

> 如果机器突然断电会怎么样？

> 取决于aof日志sync属性的配置，如果不要求性能，在每条写指令时都sync一下磁盘，就不会丢失数据。
>但在高性能的要求下每次都sync是不显示的，一般都使用定时sync，比如1s1次。这个时候最多就会丢失1s的数据。

> 然后问了我有没有了解过缓存穿透？ 这个我也是没了解过。这边还是整理下。

### 缓存穿透，缓存雪崩，缓存预热，缓存更新。缓存降级。
1. 缓存雪崩：
    简单理解为：由于原有缓存失效，新缓存未到期间。（例如：我们设置缓存时采用了相同的过期时间，在同一时刻出现大面积的缓存过期，所有原本应该为访问缓存的请求都去查询数据库了，而对数据库CPU和内存造成了巨大压力，严重的可能造成数据库宕机。从而形成一系列的连锁反应，造成了整个系统崩溃。）
    解决方法： 大多数系统设计者考虑枷锁，或者队列的方式保证不会有大量的线程对数据库一次性的进行读写，从而避免失效时大量的并发请求落到底层存储系统上。 另一种则是缓存失效时间分散开。
2. 缓存穿透：
    缓存穿透是指用户查询数据，在数据库没有，自然在缓存中也不会有，这样就导致用户查询的时候，在缓存中找不到，每次都要去数据库再查询一遍，然后返回空。这样请求就绕过缓存直接查数据库，这也是经常提的缓存命中率问题。
    解决方法：最常见的则是采用布隆过滤器，将所有可能存在数据哈希到一个足够大的bitmap中，一个一定补中存在的数据会被这个bitmap拦截掉，从而避免了对底层存储系统的查询压力。

> 持续更新中。。。。
